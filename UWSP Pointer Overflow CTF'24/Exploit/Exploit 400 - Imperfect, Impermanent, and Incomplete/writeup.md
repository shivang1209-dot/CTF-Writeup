### **Challenge Name: Exploit 400 - Imperfect, Impermanent, and Incomplete**

---

### **Description**

All things in this universe are imperfect, impermanent, and incomplete. It's what makes many jobs necessary, including cybersecurity. Anything ever created has flaws and all things degrade, erode, and become obsolete. Our job is to patch the holes. Find the bugs. Stand watch. Clean up the mess. Tend the fire. It's a job that is endless and often thankless. I've known a lot of colleagues that got overwhelmed by it. The constant vigilance and need to absorb yourself in cybersecurity news and learning on a daily basis causes stress until they burn out.

Well, I've developed a little helper. I call itt Secret-Keeper! A program that those people can interact with for therapeutic purposes. The perfect secret-keeper that will take those stressful thoughts and store them away forever. Give it a try, but please keep in mind that it is also imperfect, impermanent, and incomplete. You might need to stumble through a learning curve.

#### **Target Details**
- **IP:** `35.184.182.18`
- **Port:** `32005`
- **Environment:** Ubuntu GLIBC 2.39-0ubuntu8.3

#### **Files Provided**
- [Exploit400.c](Resources/Exploit400.c)

---

### **Approach**

#### **Step 1: Analyze the Source Code**
The source code provided, `Exploit400.c`, revealed:
1. An **off-by-one vulnerability** in memory allocation.
2. The ability to **overwrite metadata** of adjacent blocks.
3. A potential to manipulate filenames for reading sensitive files.

#### **Step 2: Heap Layout Manipulation**
The plan was to:
1. Allocate **two small blocks** (`a` and `b`) and a block for the filename.
2. Free the first block (`a`) and reclaim it.
3. Overwrite the metadata of the second block (`b`) using the off-by-one vulnerability.
4. Free `b` to place it into the tcache bin for a specific size.
5. Reallocate `b` with a size smaller than its manipulated metadata, causing it to overlap with the filename block.
6. Modify the filename block to point to the flag file.

#### **Step 3: Exploit Execution**
Using the provided exploit script (`script.py`), the following actions were performed:
1. Crafted a payload to overwrite the metadata of `b`:
   ```python
   payload = b"A" * 25 
   ```
2. Overwrote the filename with the target flag file:
   ```python
   fake_filename = b"/home/challenge/flag.txt\0"
   ```
3. Used the program's read functionality to retrieve the flag.

#### **Step 4: Retrieve the Flag**
Once the filename was overwritten, the program read the flag file, revealing:
```bash
cat /home/challenge/flag.txt
```

---

### **Flag**

`poctf{uwsp_7h3_unb34r4bl3_l1gh7n355}`

---