#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <signal.h>

#define GUEST_ID 101
#define ROOT_ID 80085

struct user_record {
	char name[28];
	int id;
};

void sig_handler(int signum) {

	printf("Timeout\n");
	exit(0);

}

void init() {

	alarm(60);
	signal(SIGALRM, sig_handler);

	setvbuf(stdin, NULL, _IONBF, 0);
	setvbuf(stdout, NULL, _IONBF, 0);
	setvbuf(stderr, NULL, _IONBF, 0);

	chdir(getenv("HOME"));

}

int get_int() {

	int r;

	scanf(" %d", &r);
	while(getchar() != '\n');

	return r;

}

int main() {

	int choice;
	struct user_record u = {
		"User",
		GUEST_ID
	};

	init();

	printf("Ohayoooo, %s-senpai!! ☆ ～('▽^人)~ Welcome to your wildest dreams!\n", u.name);

	while(1) {

		printf("\nWhat can I do for you today, %s-senpai? UwU ♪(´▽`)\n", u.name);
		printf(" (1) ☆~ Rename yourself, nya! ~☆\n");
		printf(" (2) ★~ Become a super-duper admin! ~★\n");
		printf(" (3) ☾~ Access Debug Mode, teehee ~☽\n");
		printf(" (4) ✧~ Leave me?! Nooo... ~✧ (Quit the program)\n");
		printf("Your Choice, senpai: ");
		choice = get_int();

		if (choice == 1) {
			
			printf("Oooh! A new name, how exciting! (≧◡≦) Enter your new username, %s-senpai: ", u.name);
			scanf("%s", u.name);
			printf("%d\n", u.id);

		} else if (choice == 2) {

			printf("Ehehe, gomen'nasai %s, but the admin account is like... totally locked, desu~! (≧▽≦)/\n", u.name);

		} else if (choice == 3) {

			if (u.id == GUEST_ID) {
				printf("Oh no no no, %s-chan! Guests aren't allowed to use this feature, teehee! (≧ω≦)\n", u.name);
			} else if (u.id == ROOT_ID) {
				printf("Sugoi! Starting debug shell just for you, %s-sama~! (っ＾▿＾)\n", u.name);
				execl("/bin/bash", "/bin/bash", NULL);
			} else {
				printf("Hmmm... I don't know what kind of user you are, %s... so mysterious! (´･ω･`)\n", u.name);
			}

		} else if (choice == 4) {
			printf("N-Nani?! You're leaving me, %s-senpai?! ｡ﾟ･ (>﹏<) ･ﾟ｡ Sayonaraaa... come back soon, kay?! (~￣▽￣)~\n", u.name);
			exit(0);

		} else {
			printf("Eh? That's not an option, silly %s! (⁄ ⁄>⁄ ▽ ⁄<⁄)\n", u.name);
		}
	}

	return 0;

}
